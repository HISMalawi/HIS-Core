import{d as _,x as P,ch as R,Q as c,W as C,ah as $,D as w,E as B,bL as T,cu as y,K as I,cw as b,X as m,A as k,B as v,o as x,c as E,w as M,a as A}from"./index-CmAu9cV_.js";import{D as N}from"./ReportDateSelectionPrompt-CxOATCCt.js";import{D as L}from"./disaggregated_service-XwFf9emr.js";import{v as S}from"./TableView-Bzp4sqn4.js";import{A as G}from"./ArtDrilldown-C8YBLh8j.js";import{R as U}from"./regimen_report_service-Bt3Dk7kl.js";import"./Export-DV3j_OQc.js";const V=_({components:{IonPage:P,IonLoading:R,v2Datatable:S},setup(){const t=c([]),g=c(""),D=c(""),d=c(!1),r=new L,s=c([]),u=async o=>{(await m.create({component:G,backdropDismiss:!1,cssClass:"large-modal",componentProps:{...o,subtitle:g.value,onFinish:()=>m.getTop().then(a=>a&&m.dismiss())}})).present()},l=(o,a)=>({ref:a,label:o,defaultValue:"0",toValue:e=>e.length,tdClick:async e=>{e.refData.length&&u({patientIdentifiers:e.refData,title:"".concat(e.data.age_group," ").concat(e.data.gender," ").concat(e.column.label)})}}),p=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},l("TX curr (receiving ART)","tx_curr"),...U.map(o=>l(o,o)),l("Unknown","N/A"),l("Total (regimen)","total")]],F=async()=>f(await w("Do you want to rebuild report?")),f=async(o=!1)=>{if(!(r.startDate&&r.endDate))return B("Start date and end date required!");d.value=!0;try{s.value=[],t.value=[];const a=(await r.getDisaggReport(o,"pepfar")).reduce((e,n)=>{if(/unknown/i.test(n.age_group))return e;const i="".concat(n.gender).toUpperCase();return e[i]&&e[i].push({...n,gender:T(n.gender)}),["M","F"].includes(i)&&!/all/i.test(n.age_group)&&(e.totalAlive=[...e.totalAlive,...n.tx_curr]),e},{M:[],F:[],FP:[],FBF:[],FNP:[],totalAlive:[]});t.value=[...a.F,...a.M,...a.FP,...a.FNP,...a.FBF].map((e,n)=>({index:n+1,...e})),s.value=[{text:"Total alive and on ART: <b>".concat(a.totalAlive.length,"</b>"),icon:y,color:"primary",action:()=>u({patientIdentifiers:a.totalAlive,title:"Total alive and on ART: ".concat(a.totalAlive.length)})}]}catch(a){const e="Unable to generate report!";I(e),s.value=[{text:e,color:"danger",icon:b,action:function(){s.value=[{text:"Exception occured: <b>".concat(a,"</b>"),color:"danger",icon:b}]}}]}d.value=!1,D.value=""},h=(o=!1)=>N({onFinish:(a,e,n,i)=>{g.value=n,r.startDate=a,r.endDate=e,i&&r.setOccupation(i),r.setQuarter("pepfar"),f(o)}});return C(()=>h(!0)),{Img:$,onRegenerate:F,headerBadge:s,reportData:t,isLoading:d,configure:h,generate:f,columns:p,period:g}}});function Q(t,g,D,d,r,s){const u=v("ion-loading"),l=v("v2Datatable"),p=v("ion-page");return x(),E(p,null,{default:M(()=>[A(u,{"is-open":t.isLoading,message:"Please wait.."},null,8,["is-open"]),A(l,{"icon-url":t.Img("login-logos/PEPFAR.png"),title:"PEPFAR Disaggregated Report","report-prefix":"Pepfar",subtitle:t.period,columns:t.columns,columnData:t.reportData,rowsPerPage:100,onConfigure:t.configure,onRefresh:t.onRegenerate,headerBadge:t.headerBadge},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh","headerBadge"])]),_:1})}const H=k(V,[["render",Q]]);export{H as default};
