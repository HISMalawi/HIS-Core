import{F as o}from"./dynamic-import-helper-9HnG3Mif.js";import{H as p}from"./HisStandardForm-NL7Pv0Lm.js";import{d as m,aI as u,t as a,R as n,V as c,aJ as d,_ as l,r as f,o as h,c as b}from"./index-ru8RXlaa.js";import{_ as A}from"./EncounterMixin.vue_vue_type_script_lang-SPERpwts.js";import{I as N}from"./identifier_service-S0TYscNa.js";import"./TouchScreenForm-QVpoxsVO.js";import"./ToolbarMediumCard-Mlzu3SIO.js";import"./Transformers-XlEF3tgP.js";import"./ViewPort-LUNlto_Q.js";import"./encounter_guidelines-o2Ohhd7F.js";import"./GuidelineEngine-syyQoOzo.js";const v=m({mixins:[A],components:{HisStandardForm:p},data:()=>({patientHasARVNumber:!1,currentArvNumber:"",prependValue:""}),watch:{ready:{async handler(e){if(!e)return;const t=this.patient.getArvNumber();if(t!=="Unknown"){const r=t.split("-");this.currentArvNumber=r[2].replace(/^\D+|\s/g,""),this.prependValue="".concat(r[0],"-").concat(r[1],"-"),this.patientHasARVNumber=!0}else{const r=await u.getNextSuggestedARVNumber();this.currentArvNumber=r.arv_number.replace(/^\D+|\s/g,"")}this.fields=this.getFields()},immediate:!0}},methods:{async onFinish(e){const t=e.arv_number.value;if(t===this.patient.getArvNumber())return this.$router.back();if(await N.arvNumberExists(t))a("ARV number already exists",5e3);else try{this.patientHasARVNumber?await this.patient.updateARVNumber(t):await this.patient.createArvNumber(t),n.invalidate("ACTIVE_PATIENT"),this.$router.back()}catch(i){a("".concat(i))}},getFields(){return[{id:"arv_number",helpText:"Update ARV Number",type:o.TT_TEXT,validation:e=>c.required(e),defaultValue:()=>this.currentArvNumber,config:{initialKb:"0-9",prependValue:()=>{if(this.prependValue)return this.prependValue;const e=d.getActiveApp();return e&&e.programPatientIdentifiers?e.programPatientIdentifiers["ARV Number"].prefix():""},footerBtns:[{name:"Void ARV Number",slot:"end",color:"danger",onClick:async()=>{await this.patient.updateARVNumber("Unknown"),n.invalidate("ACTIVE_PATIENT"),this.$router.back()}}]}}]}}});function V(e,t,r,i,_,g){const s=f("his-standard-form");return h(),b(s,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}const S=l(v,[["render",V]]);export{S as default};
