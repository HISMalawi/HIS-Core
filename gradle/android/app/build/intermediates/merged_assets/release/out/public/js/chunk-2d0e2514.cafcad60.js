(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e2514"],{"7dd5":function(e,t,a){"use strict";a.r(t);var i=a("7a23");function s(e,t,a,s,n,r){const o=Object(i["resolveComponent"])("his-standard-form");return Object(i["openBlock"])(),Object(i["createBlock"])(o,{fields:e.fields,activeField:e.activeField,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","activeField","onFinishAction","cancelDestinationPath"])}var n=a("d95e"),r=a("7920"),o=a("2706"),c=a("9283"),d=a("3d6c"),l=a("b5e4"),u=Object(i["defineComponent"])({components:{HisStandardForm:r["a"]},data:()=>({activeField:"",fields:[],drugs:[],selectedDrugs:[],barcode:"",stockService:{}}),methods:{async onFinish(e){const t=e.enter_batches,a=[];for(let i=0;i<t.length;i++){const s=t[i].value,n={current_quantity:s["current_quantity"],reason:e.reason.value},r=await this.stockService.updateItem(s["pharmacy_batch_id"],n);r||a.push("could not stock for "+t[i].shortName)}0===a.length?(Object(l["d"])("Stock succesfully updated"),this.$router.push("/")):Object(l["c"])("Could not save stock")},getFields(){return[{id:"date",helpText:"Verfication Date",type:n["b"].TT_FULL_DATE,validation:e=>o["a"].required(e)},{id:"enter_batches",helpText:"Batch entry",type:n["b"].TT_BATCH_VERIFICATION,options:()=>this.drugs,validation:e=>o["a"].required(e)},{id:"reason",helpText:"Select reason",type:n["b"].TT_SELECT,validation:e=>o["a"].required(e),options:()=>[{label:"Monthly stock take",value:"Monthly stock take"},{label:"Audit",value:"Audit"},{label:"Adhoc (due to stock imbalance)",value:"Adhoc (due to stock imbalance)"},{label:"Supervision",value:"Supervision"}]},{id:"verification_summary",helpText:"Summary",type:n["b"].TT_TABLE_VIEWER,options:e=>this.buildResults(e.enter_batches),config:{hiddenFooterBtns:["Clear"]}}]},buildResults(e){const t=["Drug","Total units","Expiry date"],a=e.map(e=>{const t=e.value;return[t.shortName,t["current_quantity"],c["b"].toStandardHisDisplayFormat(t.expiry_date)]});return[{label:"Confirm entry",value:"Table",other:{columns:t,rows:a}}]},prepDrugs(e){const t=[],a=this.barcode;return e.enter_batches.value.forEach(i=>{t.push({batch_number:i.batchNumber,items:[{barcode:a,drug_id:i.drugID,expiry_date:i.expiry,quantity:parseInt(i.tabs)*parseInt(i.tins),delivery_date:e.date.value}]})}),t},selectAll(e){return e.map(e=>(e.isChecked=!0,e))},formatDrugs(){return this.stockService.drugList().map(e=>({label:e.shortName,value:e}))}},created(){this.stockService=new d["a"],this.fields=this.getFields(),this.drugs=this.formatDrugs()}}),h=a("6b0d"),p=a.n(h);const b=p()(u,[["render",s]]);t["default"]=b}}]);
//# sourceMappingURL=chunk-2d0e2514.cafcad60.js.map