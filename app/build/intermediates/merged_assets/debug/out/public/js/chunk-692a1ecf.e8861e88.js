(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-692a1ecf"],{"0207":function(t,e,a){"use strict";a("cc99")},"12f0":function(t,e,a){"use strict";a.r(e);var i=a("7a23");function n(t,e,a,n,o,r){const s=Object(i["resolveComponent"])("information-header"),l=Object(i["resolveComponent"])("visit-information"),c=Object(i["resolveComponent"])("ion-content"),d=Object(i["resolveComponent"])("his-footer"),u=Object(i["resolveComponent"])("ion-page");return Object(i["openBlock"])(),Object(i["createBlock"])(u,{style:{background:"#fff"}},{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(s,{items:t.patientCardInfo,numberOfColumns:4,onAddGuardian:t.addGuardian,onUpdate:t.updateDemographics,onUpdateARVNumber:t.updateARVNumber},null,8,["items","onAddGuardian","onUpdate","onUpdateARVNumber"]),Object(i["createVNode"])(c,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(l,{getVisitDates:t.getPatientVisitDates,onOnPrint:t.printLabel,style:{"font-size":"11px"}},null,8,["getVisitDates","onOnPrint"])]),_:1}),Object(i["createVNode"])(d,{btns:t.btns},null,8,["btns"])]),_:1})}var o=a("9283"),r=a("23e6"),s=a("7957");const l=Object(i["withScopeId"])("data-v-94355f20");Object(i["pushScopeId"])("data-v-94355f20");const c={style:{padding:".1rem"}},d={style:{width:"100%",display:"flex",justifyContent:"space-between",fontSize:"12px",margin:0,padding:0}};Object(i["popScopeId"])();const u=l((function(t,e,a,n,o,r){const s=Object(i["resolveComponent"])("ion-item"),u=Object(i["resolveComponent"])("ion-list"),p=Object(i["resolveComponent"])("multi-column-view");return Object(i["openBlock"])(),Object(i["createBlock"])("div",c,[Object(i["createVNode"])(p,{items:t.items,numberOfColumns:t.numberOfColumns},{default:l(({entries:e})=>[Object(i["createVNode"])(u,null,{default:l(()=>[(Object(i["openBlock"])(!0),Object(i["createBlock"])(i["Fragment"],null,Object(i["renderList"])(e,e=>(Object(i["openBlock"])(),Object(i["createBlock"])(s,{key:e.label,style:{padding:"0 !important",margin:"0 !important"}},{default:l(()=>[Object(i["createVNode"])("div",d,[Object(i["createVNode"])("span",null,Object(i["toDisplayString"])(e.label)+": ",1),e.other&&e.other.editable?(Object(i["openBlock"])(),Object(i["createBlock"])("span",{key:0,onClick:a=>t.onClick(e)},[Object(i["createVNode"])("a",null,[Object(i["createVNode"])("b",null,Object(i["toDisplayString"])(e.value),1)])],8,["onClick"])):(Object(i["openBlock"])(),Object(i["createBlock"])("b",{key:1,innerHTML:e.value||"N/A"},null,8,["innerHTML"]))])]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["items","numberOfColumns"])])}));var p=a("92c1"),b=Object(i["defineComponent"])({name:"InformationHeader",components:{MultiColumnView:p["a"]},props:{icon:{required:!1},items:{type:Object,required:!0},numberOfColumns:{type:Number,default:2}},emits:["update","updateARVNumber","addGuardian"],setup(t,{emit:e}){const a=t=>"demographics"===t.other.category?e("update",t.other.attribute):"arv_number"===t.other.category?e("updateARVNumber"):e("addGuardian");return{onClick:a}}}),m=(a("8945"),a("6b0d")),h=a.n(m);const g=h()(b,[["render",u],["__scopeId","data-v-94355f20"]]);var O=g;const v=Object(i["withScopeId"])("data-v-2d39ef92");Object(i["pushScopeId"])("data-v-2d39ef92");const f={class:"report-content"};Object(i["popScopeId"])();const j=v((function(t,e,a,n,o,r){const s=Object(i["resolveComponent"])("report-table");return Object(i["openBlock"])(),Object(i["createBlock"])("div",f,[Object(i["createVNode"])(s,{asyncRows:t.getRows,columns:t.columns,config:t.tableConfig},null,8,["asyncRows","columns","config"])])}));var y=a("2ef0"),C=a("80e3"),I=a("9ceb"),w=a("8a30");const V=Object(i["createTextVNode"])(" Close ");function D(t,e,a,n,o,r){const s=Object(i["resolveComponent"])("ion-title"),l=Object(i["resolveComponent"])("ion-toolbar"),c=Object(i["resolveComponent"])("ion-header"),d=Object(i["resolveComponent"])("information-header"),u=Object(i["resolveComponent"])("ion-content"),p=Object(i["resolveComponent"])("ion-button"),b=Object(i["resolveComponent"])("ion-footer");return Object(i["openBlock"])(),Object(i["createBlock"])(i["Fragment"],null,[Object(i["createVNode"])(c,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(l,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(s,null,{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])(Object(i["toDisplayString"])(t.title),1)]),_:1})]),_:1})]),_:1}),Object(i["createVNode"])(u,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(d,{items:t.visitData},null,8,["items"])]),_:1}),Object(i["createVNode"])(b,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(l,null,{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(p,{onClick:t.closeModal,slot:"end"},{default:Object(i["withCtx"])(()=>[V]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}var A=Object(i["defineComponent"])({components:{InformationHeader:O},props:{title:{type:String,required:!0},visitData:{type:Object,required:!0}},methods:{async closeModal(){await w["X"].dismiss({})}}});const N=h()(A,[["render",D]]);var k=N;const T={style:{fontSize:"11px !important",border:"1px solid #dddddd !important",textAlign:"left"}},x={style:{fontSize:"12px !important",fontWeight:"bold",textAlign:"left",border:"1px solid #dddddd !important"}};var _=Object(i["defineComponent"])({name:"HisResultCard",components:{ReportTable:C["a"]},data:()=>({tableConfig:{showIndex:!1,cssClasses:"table-bordered table-striped"},columns:[[I["a"].thTxt("VISIT DATE",x),I["a"].thTxt("WEIGHT (Kg)",x),I["a"].thTxt("REG",x),I["a"].thTxt("VIRAL LOAD",x),I["a"].thTxt("TB STATUS",x),I["a"].thTxt("OUTCOME",x),I["a"].thTxt("PILLS DISPENSED",x),I["a"].thTxt("ACTIONS",x)]]}),props:{icon:{required:!1},getVisitDates:{type:Function,required:!0}},methods:{printLabel(t){this.$emit("onPrint",t)},showMore(t){this.$emit("onDetails",t)},formatAdherence(t){if(Object(y["isArray"])(t)){const e=[...t];if(Object(y["isArray"])(e)){let t="";return e.forEach(e=>{t+=`${e[0]}: (${e[1]}%), `}),t}return e}return t},joinData(t){if(Object(y["isArray"])(t)){const e=[...t];if(Object(y["isArray"])(e)){let t="";return e.forEach(e=>{t+=(Object(y["isArray"])(e)?e.join(":"):e)+", "}),t}return e}return t},capitalize(t){try{return t.charAt(0).toUpperCase()+t.slice(1)}catch(e){return""}},camelCase(t){const e=t.split("_");return`${this.capitalize(e[0])} ${this.capitalize(e[1])}`},async getRows(){const t=await this.getVisitDates();return t.map(t=>{var e,a;const i=((null===(e=t.data)||void 0===e||null===(a=e.drugs)||void 0===a?void 0:a.pills_given)||[]).map(t=>`${t["short_name"]||t["name"]} <b>(${t.quantity||"?"})</b>`).join("<br/>"),n=[];return Object.keys(t.data).forEach(e=>{switch(e){case"drugs":break;case"pills_dispensed":n.push({label:"Pills dispensed",value:i});break;case"outcome_date":n.push({label:"Outcome Date",value:o["b"].toStandardHisDisplayFormat(t.data[e])});break;default:e.match(/height/i)&&(e+=" (cm)"),e.match(/weight/i)&&(e+=" (Kg)"),n.push({label:this.camelCase(e),value:this.joinData(t.data[e])})}}),[I["a"].tdBtn(t.label,()=>this.printLabel(t.value),T,"secondary"),I["a"].td(t.data.weight,T),I["a"].td(t.data.regimen,T),I["a"].td(t.data["viral_load"],T),I["a"].td(t.data["tb_status"],T),I["a"].td(t.data.outcome.match(/Unk/i)?"Unknown":t.data.outcome,T),I["a"].td(i,T),I["a"].tdBtn("show more",async()=>{(await w["X"].create({component:k,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:t.label,visitData:n}})).present()},T,"secondary")]})}}});a("0207");const B=h()(_,[["render",j],["__scopeId","data-v-2d39ef92"]]);var S=B,P=a("0f25"),R=a("ec2a"),E=a("7def"),F=a("b5e4"),H=a("ad60"),$=a("4db7"),G=Object(i["defineComponent"])({components:{IonPage:w["D"],IonContent:w["n"],VisitInformation:S,InformationHeader:O,HisFooter:P["a"]},data:()=>({isBDE:!1,currentDate:"",sessionDate:"",nextTask:{},patientId:0,programID:0,patient:{},patientProgram:{},patientCardInfo:[],programCardInfo:[],encounters:[],medications:[],labOrders:[],visitDates:[],activeVisitDate:"",encountersCardItems:[],medicationCardItems:[],labOrderCardItems:[],alertCardItems:[],btns:[],guardians:""}),computed:{visitDatesTitle(){return this.visitDates.length+" Visits"}},watch:{$route:{async handler({params:t}){t&&(this.patientId=parseInt(t.patient_id),this.patientId&&this.init())},deep:!0,immediate:!0},async activeVisitDate(t){this.encounters=await R["a"].getEncounters(this.patientId,{date:t})}},methods:{async init(){this.patient=await this.fetchPatient(this.patientId),this.guardians=await this.getGuardian(),this.patientCardInfo=await this.getPatientCardInfo(this.patient),this.btns.push(this.getFinishBtn())},async getGuardian(){const t=await E["a"].getGuardianDetails(this.patientId);return t.map(t=>` ${t.name} (${t.relationshipType})`).join(" ")},updateDemographics(t){this.$router.push({path:"/patient/registration",query:{edit_person:this.patientId,person_attribute:t}})},addGuardian(){var t;this.$router.push({path:"/guardian/registration/"+this.patientId,query:{source:null===(t=this.$route.name)||void 0===t?void 0:t.toString()}})},updateARVNumber(){this.$router.push({name:"Edit ARV Number"})},getFinishBtn(){return{name:"Finish",color:"success",size:"large",slot:"end",visible:!0,onClick:async()=>{const t=await Object(F["a"])("Are you sure you want to exit?");if(t)return this.$router.push("/patient/dashboard/"+this.patientId)}}},async fetchPatient(t){const e=await r["a"].findByID(t);return e?new r["a"](e):{}},getProp(t,e){return e in t?t[e]():"-"},async getPatientVisitDates(){const t=await r["a"].getPatientVisits(this.patientId,!0),e=t.map(async t=>{const e=await this.getExtras(t);return{label:o["b"].toStandardHisDisplayFormat(t),value:t,data:e}}),a=await Promise.all(e);return a},async getExtras(t){const e=await H["a"].getCurrentProgramInformation(this.patientId,t),a=await H["a"].getMastercardDrugInformation(this.patientId,t);return{...e,drugs:a}},onActiveVisitDate(t){this.activeVisitDate=t.value},async getPatientCardInfo(t){const{toStandardHisDisplayFormat:e}=o["b"];let a=await s["a"].getAll(this.patientId,"Confirmatory HIV test date");a&&(a=e(a[0].value_datetime));const i=await s["a"].getFirstValueText(this.patientId,"Confirmatory HIV test location");let n=await s["a"].getAll(this.patientId,"Date ART started");n=Object(y["isEmpty"])(n)?"N/A":e(n[0].value_datetime);const r=await s["a"].getFirstValueCoded(this.patientId,"Ever received ART"),l=await s["a"].getFirstValueCoded(this.patientId,"Agrees to followup"),c=await s["a"].getFirstValueCoded(this.patientId,"Reason for ART eligibility");return[{label:"ARV Number",value:this.patient.getArvNumber(),other:{editable:!0,category:"arv_number"}},{label:"National Patient ID",value:t.getNationalID()},{label:"Given Name",value:t.getGivenName(),other:{editable:!0,attribute:"given_name",category:"demographics"}},{label:"Family Name",value:t.getFamilyName(),other:{editable:!0,attribute:"family_name",category:"demographics"}},{label:"Age",value:t.getAge(),other:{editable:!0,attribute:"year_birth_date",category:"demographics"}},{label:"Sex",value:t.getGender(),other:{editable:!0,attribute:"gender",category:"demographics"}},{label:"Location",value:t.getCurrentVillage(),other:{editable:!0,attribute:"home_region",category:"demographics"}},{label:"Landmark",value:t.getAttribute(19)},{label:"Guardian",value:this.guardians?this.guardians:"add",other:{editable:!this.guardians,attribute:"",category:"guardian"}},{label:"Init W(KG)",value:await t.getInitialWeight()},{label:"Init H(CM)",value:await t.getInitialHeight()},{label:"BMI(CM)",value:await t.getInitialBMI()},{label:"TI",value:r},{label:"Agrees to follow up",value:l},{label:"Reason for starting ART",value:c},{label:"HIV test date",value:""+(a||"")},{label:"HIV test place",value:""+(i||"")},{label:"Date of starting first line ART",value:n},...await this.getTBStats()]},async getTBStats(){const t=await s["a"].getFirstValueCoded(this.patientId,"Who stages criteria present");return[{label:"Pulmonary TB within the last 2 years",value:t&&t.match(/last/i)?"Yes":"N/A"},{label:"Extra pulmonary TB (EPTB)",value:t&&t.match(/eptb/i)?"Yes":"N/A"},{label:"Pulmonary TB (current)",value:t&&t.match(/current/i)?"Yes":"N/A"},{label:"Kaposi's sarcoma:",value:t&&t.match(/kepos/i)?"Yes":"N/A"}]},async openModal(t,e,a){const i=o["b"].toStandardHisDisplayFormat(this.activeVisitDate.toString()),n=await w["X"].create({component:a,backdropDismiss:!1,cssClass:"custom-modal",componentProps:{items:t,title:`${e}: ${i}`,taskParams:{patient:this.patient.getObj(),program:this.patientProgram,visitDate:this.activeVisitDate,patientID:this.patientId}}});n.present()},printLabel(t){new $["a"](this.patientId).printVisitSummaryLbl(t)}}});const L=h()(G,[["render",n]]);e["default"]=L},"5a7d":function(t,e,a){},8945:function(t,e,a){"use strict";a("5a7d")},cc99:function(t,e,a){}}]);
//# sourceMappingURL=chunk-692a1ecf.e8861e88.js.map