System.register(["./ViewPort-legacy-vAtaXxEN.js","./dynamic-import-helper-legacy-BhGHTWZn.js","./SIngleTouchField-legacy-bp3msIa4.js","./index-legacy-Ezw3ESUe.js","./EncounterMixin.vue_vue_type_script_lang-legacy-Re_H2r82.js","./htn_service-legacy-3NbDZ9XG.js","./encounter_guidelines-legacy-66fDtSjB.js","./GuidelineEngine-legacy--xbEVG44.js","./HisStandardForm-legacy-xovrdhbF.js","./TouchScreenForm-legacy--Rf9oyT4.js","./ToolbarMediumCard-legacy-_H0PbO4B.js","./Transformers-legacy-PbfCTy2a.js"],(function(e,t){"use strict";var a,n,s,o,r,d,i,l,u,c,g,p,h,b,m,f,v,y,x,w,k,_,C,I,N,D,P,T,H,j,S,z,E,F,O;return{setters:[e=>{a=e.V},e=>{n=e.F},e=>{s=e.T},e=>{o=e.d,r=e.i,d=e.j,i=e.l,l=e.aj,u=e.f,c=e.ak,g=e.m,p=e.I,h=e.e,b=e.aI,m=e.ab,f=e.t,v=e.O,y=e._,x=e.r,w=e.o,k=e.c,_=e.w,C=e.b,I=e.x,N=e.A,D=e.F,P=e.y,T=e.u,H=e.v,j=e.z,S=e.a3,z=e.a4},e=>{E=e._},e=>{F=e.B,O=e.H},null,null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent="ion-checkbox[data-v-19de36ab]{--size: 30px}.col-borders[data-v-19de36ab]{border:1px dotted lightgray;border-radius:3px}#main-table[data-v-19de36ab],#table-notes[data-v-19de36ab]{width:95%;margin:auto}#main-table th[data-v-19de36ab],#table-notes th[data-v-19de36ab]{font-size:20px;background-color:#b22222;color:#fff}#main-table th[data-v-19de36ab],#main-table td[data-v-19de36ab]{text-align:center;padding:10px}.td-title[data-v-19de36ab]{font-size:22px;text-shadow:2px 2px white}.td-title[data-v-19de36ab],.td-current[data-v-19de36ab],.td-remaining[data-v-19de36ab]{padding:2px!important}.td-current[data-v-19de36ab]{background-color:#eed5d2;text-shadow:2px 2px white;height:40px!important}.td-remaining[data-v-19de36ab]{background-color:#ffe5e5;text-shadow:2px 2px white}.td-value[data-v-19de36ab]{font-size:22px}caption[data-v-19de36ab]{font-weight:700;font-size:26px;color:rgba(0,0,0,.8)}#table-notes td[data-v-19de36ab]{background:rgba(210,220,240,.5);border-radius:5px}.table-inner-notes[data-v-19de36ab]{width:100%}#table-notes th[data-v-19de36ab]{background:lightgray;color:rgba(0,0,0,.8)}#table-notes td[data-v-19de36ab]{padding-left:1px}.date-td[data-v-19de36ab]{padding-left:4px!important;text-shadow:0 1px 1px rgba(0,0,0,.2);font-size:1em;background:rgba(235,235,240,.5)!important;color:rgba(0,0,0,.9)}.note-td[data-v-19de36ab]{padding-left:20px!important;color:rgba(0,0,0,.8);text-shadow:2px 2px 3px rgba(255,255,255,.1)}.notes-scroll[data-v-19de36ab]{height:265px!important;overflow:auto}.today-tr[data-v-19de36ab]{font-style:italic;font-weight:700;border-radius:10px!important}\n",document.head.appendChild(t);const B=o({mixins:[E],components:{ViewPort:a,IonToolbar:r,IonHeader:d,IonContent:i,IonRow:l,IonButton:u,IonCol:c,IonFooter:g,IonPage:p,IonCheckbox:h},watch:{ready:{async handler(e){if(e){this.HTN=new F(this.patientID,this.providerID),this.drugs=this.HTN.getDrugs();const{drugs:e,notes:t}=await this.HTN.getCurrentDrugs();this.setPreviousBpDrugs(e),this.setPreviousBpNotes(t),this.canClearHtnSessionPrescription=this.patientHasHtnSessionKey()}},immediate:!0}},data:()=>({HTN:{},drugs:null,canClearHtnSessionPrescription:!1}),methods:{clearPrescriptionInSession(){sessionStorage.removeItem(O.Prescription),this.canClearHtnSessionPrescription=!1},patientHasHtnSessionKey(){try{const e=sessionStorage.getItem(O.Prescription);if(e)return JSON.parse(e)[this.patientID]}catch(e){console.warn(e)}return!1},removeNote(e,t){this.drugs[e].notes.splice(t,1)},launchNotePad(e){this.showModal({id:"note",helpText:`Add notes for ${e}`,type:n.TT_TEXT},(t=>{t&&this.drugs[e].notes.push({date:b.getSessionDate(),description:t.value||"",drugID:this.drugs[e].drugs[0].drugID,isNewNote:!0})}))},async onFinish(){const e=Object.values(this.drugs).filter((e=>!m.isEmpty(e.notes))).map((e=>e.notes)).reduce(((e,t)=>e.concat(t)),[]).filter((e=>e.isNewNote)).map((e=>this.HTN.buildObs("Clinician notes",{value_text:e.description,value_drug:e.drugID})));if(!m.isEmpty(e))try{await this.HTN.createEncounter(),await this.HTN.saveObservationList(await Promise.all(e))}catch(t){return f(`Unable to save notes ${t}`)}this.gotoTreatment()},gotoTreatment(){const e=this.selectedDrugs.map((e=>m.find(F.htnDrugReferences(),{drug_id:e.drugID}))),t={};t[this.patientID]=e,sessionStorage.setItem(O.Prescription,JSON.stringify(t)),this.$router.push(`/art/encounters/prescriptions/${this.patientID}`)},async showModal(e,t){(await v.create({component:s,backdropDismiss:!1,cssClass:"full-modal",componentProps:{dismissType:"modal",currentField:e,onFinish:t}})).present()},setPreviousBpNotes(e){for(const t in e)this.drugs[t].notes=Object.keys(e[t]).map((a=>e[t][a].map((e=>({date:a,description:e,isNewNote:!1}))))).reduce(((e,t)=>e.concat(t)),[])},setPreviousBpDrugs(e){e.forEach((e=>{for(const t in this.drugs)this.drugs[t].drugs.forEach(((a,n)=>{e.drug_id===a.drugID&&(this.drugs[t].drugs[n].current=!0,this.drugs[t].drugs[n].selected=!0,this.drugs[t].selected=e.drug_id)}))}))},selectDrug(e,t,a){this.drugs[e].drugs.forEach(((t,a)=>{this.drugs[e].drugs[a].selected=!1})),this.drugs[e].drugs[t].selected=a.detail.checked}},computed:{selectedDrugs(){return this.drugs?Object.values(this.drugs).map((e=>e.drugs)).reduce(((e,t)=>e.concat(t)),[]).filter((e=>e.selected)):[]}}}),A=e=>(S("data-v-19de36ab"),e=e(),z(),e),M=A((()=>N("label",{class:"his-title"}," Prescribe BP drugs ",-1))),$={key:0,class:"view-port-content"},J={id:"main-table",style:{width:"100%"}},V=A((()=>N("th",null," ",-1))),K=A((()=>N("td",{class:"td-remaining td-title"},[N("span",null,"New/Current")],-1))),R=A((()=>N("td",{class:"td-remaining td-title"},[N("span",null," ")],-1))),X=A((()=>N("p",null,null,-1))),Z={id:"table-notes",style:{width:"100%"}},G=A((()=>N("caption",{style:{"font-size":"1.2em"}}," Notes ",-1))),L=A((()=>N("p",null,null,-1))),U={class:"table-inner-notes",id:"notes-HCZ"},q={class:"date-td today-td"},Q={class:"date-td today-td"};e("default",y(B,[["render",function(e,t,a,n,s,o){const r=x("ion-col"),d=x("ion-row"),i=x("ion-toolbar"),l=x("ion-header"),u=x("ion-checkbox"),c=x("ion-button"),g=x("view-port"),p=x("ion-content"),h=x("ion-footer"),b=x("ion-page");return w(),k(b,null,{default:_((()=>[C(l,null,{default:_((()=>[C(i,null,{default:_((()=>[C(d,null,{default:_((()=>[C(r,null,{default:_((()=>[M])),_:1})])),_:1})])),_:1})])),_:1}),C(p,null,{default:_((()=>[C(g,null,{default:_((()=>[e.drugs?(w(),I("div",$,[N("table",J,[N("tr",null,[V,(w(!0),I(D,null,P(e.drugs,((e,t)=>(w(),I("th",{key:t},[T(H(t)+" ",1),C(d,null,{default:_((()=>[(w(!0),I(D,null,P(e.drugs,((e,t)=>(w(),k(r,{class:"col-borders",key:t},{default:_((()=>[T(H(e.amount||"0mg"),1)])),_:2},1024)))),128))])),_:2},1024)])))),128))]),N("tr",null,[K,(w(!0),I(D,null,P(e.drugs,((t,a)=>(w(),I("td",{key:a,class:"td-current td-value"},[C(d,null,{default:_((()=>[(w(!0),I(D,null,P(t.drugs,((t,n)=>(w(),k(r,{key:n},{default:_((()=>[C(u,{checked:t.selected,onIonChange:t=>e.selectDrug(a,n,t)},null,8,["checked","onIonChange"])])),_:2},1024)))),128))])),_:2},1024)])))),128))]),N("tr",null,[R,(w(!0),I(D,null,P(Object.keys(e.drugs),((t,a)=>(w(),I("td",{class:"td-remaining td-value",key:a},[C(d,null,{default:_((()=>[C(r,null,{default:_((()=>[C(c,{onClick:a=>e.launchNotePad(t),color:"warning"},{default:_((()=>[T(" Add notes ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])))),128))])]),X,N("table",Z,[G,L,N("tr",null,[(w(!0),I(D,null,P(e.drugs,((e,t)=>(w(),I("th",{style:{width:"25%"},key:t},[N("span",null,H(t),1)])))),128))]),N("tr",null,[(w(!0),I(D,null,P(Object.keys(e.drugs),((t,a)=>(w(),I("td",{id:"HCZ",style:{"padding-top":"2px !important"},valign:"top",key:a},[N("table",U,[(w(!0),I(D,null,P(e.drugs[t].notes,((a,n)=>(w(),I("tr",{key:n},[N("td",q,H(a.date),1),N("td",Q,H(a.description),1),N("td",null,[a.isNewNote?(w(),k(c,{key:0,color:"danger",onClick:a=>e.removeNote(t,n)},{default:_((()=>[T(" X ")])),_:2},1032,["onClick"])):j("",!0)])])))),128))])])))),128))])])])):j("",!0)])),_:1})])),_:1}),C(h,null,{default:_((()=>[C(i,{color:"dark"},{default:_((()=>[C(c,{size:"large",color:"danger",slot:"start",onClick:e.gotoPatientDashboard},{default:_((()=>[T(" cancel ")])),_:1},8,["onClick"]),e.canClearHtnSessionPrescription?(w(),k(c,{key:0,size:"large",color:"warning",slot:"end",onClick:e.clearPrescriptionInSession},{default:_((()=>[T(" Clear Session Prescription ")])),_:1},8,["onClick"])):j("",!0),e.selectedDrugs&&e.selectedDrugs.length>0?(w(),k(c,{key:1,size:"large",color:"success",slot:"end",onClick:e.onFinish},{default:_((()=>[T(" Continue ")])),_:1},8,["onClick"])):j("",!0)])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-19de36ab"]]))}}}));
