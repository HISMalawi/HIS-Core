import{d as P,I as k,c2 as I,K as b,N as F,a9 as M,O as d,t as N,ab as T,c3 as q,q as B,c4 as E,c5 as O,c6 as S,c7 as H,_ as U,r as x,o as L,c as X,w as j,b as R}from"./index-ru8RXlaa.js";import{D as V}from"./ReportDateSelectionPrompt-eYua7e2Q.js";import{T as W}from"./tx_report_service-nlVPnMYP.js";import{v as G}from"./TableView-y6cRmPnC.js";import{A as y}from"./ArtDrilldown-K6cLkdWZ.js";import{R as K}from"./ReportErrors-ArLMvFHk.js";import{M as Q}from"./moh_cohort_service-LMRt99gj.js";import"./dynamic-import-helper-9HnG3Mif.js";import"./MultiFieldDateHelper-5DHelb14.js";import"./KbLayouts-9dqmDWmG.js";import"./HisKbConfigurations-a7K7dizM.js";import"./PopupKeyboard-pOAE1R5L.js";import"./SIngleTouchField-Vfu2y1a0.js";import"./TouchScreenForm-QVpoxsVO.js";import"./ToolbarMediumCard-Mlzu3SIO.js";import"./Transformers-XlEF3tgP.js";import"./ViewPort-LUNlto_Q.js";import"./HisKeypad-SWQeflLk.js";import"./BaseKeyboard-Ac7oOUZ2.js";import"./KbHandler-oqPdZ1-Q.js";import"./overlays-9d7511dd-ZrAfACNh.js";import"./fuse-lCMBsAWg.js";import"./Export-jNK5-P5e.js";import"./HisKeyboard-X4xvPg-w.js";import"./person_service-MW3N1HJm.js";const z=P({components:{IonPage:k,IonLoading:I,v2Datatable:G},setup(){const o=b([]),u=b(""),f=b(!1),l=new W,c=b([]),_=new Q,m=(t,s)=>({ref:s,label:t,toValue:a=>a.length,tdClick:async a=>{a.refData.length&&(await d.create({component:y,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:u,patientIdentifiers:a.refData,title:"".concat(a.data.age_group," ").concat(a.data.gender," ").concat(a.column.label),onFinish:()=>d.getTop().then(e=>e&&d.dismiss())}})).present()}}),D=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},m("Tx new CD4 <200","cd4_less_than_200"),m("Tx new CD4 >=200","cd4_greater_than_equal_to_200"),m("Tx new CD4 Unknown","cd4_unknown_or_not_done"),m("Transfer-ins","transfer_in")]],g=function(t){const s=c.value.findIndex(a=>a.id===t.id);s!==-1?c.value[s]=t:c.value.push(t)},v=async function(t){const s="validationErrors";(await d.create({id:s,component:K,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:t}})).present(),g({id:s,text:"<b>".concat(t.length,"</b> validation errors detected"),icon:H,color:"danger",action:()=>v(t)})};function A(t){const s={initiated_on_art_first_time:{param:t.total,check:(e,n)=>e!=n,error:(e,n)=>"\n                        MOH cohort initiated on ART first time <b>(".concat(e,")</b> is not matching Tx New <b>(").concat(n,")</b>\n                    ")},initial_pregnant_females_all_ages:{param:t.pregnant,check:(e,n)=>e!=n,error:(e,n)=>"\n                        MOH cohort initial pregnant females all ages \n                        <b>(".concat(e,")</b> is not matching with TX new Pregnant women <b>").concat(n,"</b>\n                    ")},males_initiated_on_art_first_time:{param:t.male,check:(e,n)=>e!=n,error:(e,n)=>"\n                        MoH Cohort males initiated on ART first time <b>(".concat(e,")</b>\n                        is not matching with TX new All male <b>(").concat(n,")</b>\n                    ")},"quarterly_re_initiated_on_art + transfer_in":{param:t.transfer_in,check:(e,n)=>e!=n,error:(e,n)=>"\n                        Quarterly Transfer In + Reinitiated Clients <b>".concat(e,"</b>  does not match Transfer In <b>").concat(n,"</b> clients in TXNEW report\n                    ")}};_.validateIndicators(s,e=>{e.length?v(e):g({id:"reportOk",text:"<b>Report is consistent</b>",icon:S,color:"success"})})===-1&&v(["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])}const C=async()=>{if(!(l.startDate&&l.endDate))return N("Start date and end date required!");f.value=!0,o.value=[];try{const t=await l.getTxNewReport(),a=t.filter(r=>!["All"].includes(r.age_group)).reduce((r,i)=>(r[i.gender]=Object.keys(i).reduce((p,h)=>Array.isArray(i[h])?{...p,[h]:[...p[h]||[],...i[h]]}:p,r[i.gender]||{}),r),{Male:{},Female:{}});o.value=t;const e=t.reduce((r,i)=>{if(["FP","FBf"].includes(i.gender)){const p=Object.values(i).filter(Array.isArray).flat();return r.concat(p)}return r},[]),n=["cd4_less_than_200","cd4_greater_than_equal_to_200","cd4_unknown_or_not_done"],w=T.uniq(["Female","Male"].reduce((r,i)=>[...r,...n.map(p=>a[i][p]).flat(1)],[]));g({id:"stats",text:"Tx new <b>".concat(w.length,"</b>"),icon:q,color:"primary",action:async()=>{(await d.create({component:y,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"All TxNew",subtitle:u.value,patientIdentifiers:w,onFinish:()=>d.getTop().then(r=>r&&d.dismiss())}})).present()}}),A({total:w.length,pregnant:T.uniq(n.map(r=>a.Female[r].filter(i=>e.includes(i))).flat(1)).length,male:T.uniq(n.map(r=>a.Male[r]).flat(1)).length,transfer_in:[...a.Male.transfer_in,...a.Female.transfer_in].length}),o.value=o.value.map((r,i)=>({index:i+1,...r}))}catch(t){console.error("".concat(t)),B("Unable to generate report!"),c.value=[{text:"Unable to generate report!",color:"danger",icon:E,action:function(){c.value=[{text:"Exception occured: <b>".concat(t,"</b>"),color:"danger",icon:O}]}}]}f.value=!1},$=()=>V({onFinish:(t,s,a,e)=>{u.value=a,l.startDate=t,l.endDate=s,e&&l.setOccupation(e),_.setStartDate(l.startDate),_.setEndDate(l.endDate),C()}});return F(()=>$()),{Img:M,headerBadge:c,reportData:o,isLoading:f,configure:$,generate:C,columns:D,period:u}}});function J(o,u,f,l,c,_){const m=x("ion-loading"),D=x("v2Datatable"),g=x("ion-page");return L(),X(g,null,{default:j(()=>[R(m,{"is-open":o.isLoading,message:"Please wait..."},null,8,["is-open"]),R(D,{"icon-url":o.Img("login-logos/PEPFAR.png"),title:"Pepfar Tx New","report-prefix":"Pepfar",subtitle:o.period,columns:o.columns,columnData:o.reportData,rowsPerPage:100,headerBadge:o.headerBadge,onConfigure:o.configure,onRefresh:o.generate},null,8,["icon-url","subtitle","columns","columnData","headerBadge","onConfigure","onRefresh"])]),_:1})}const xe=U(z,[["render",J]]);export{xe as default};
