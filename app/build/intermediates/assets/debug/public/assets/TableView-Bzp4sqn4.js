import{d as te,i as ne,m as ae,aA as re,n as se,j as le,I as ie,s as ue,v as ce,k as de,ce as fe,az as pe,ap as he,bz as ye,bA as ke,O as me,Q as $,U as E,ag as ve,ci as ge,cj as Ce,ck as be,cl as Pe,cm as we,cn as Ie,co as Se,cp as Ve,b7 as De,S as N,as as _e,cq as $e,cr as Te,aj as X,bB as ze,cs as Fe,A as Re,B as f,o as n,f as v,a as r,w as t,c as h,M as y,e as g,t as V,h as T,F as z,g as U,aD as Be}from"./index-CmAu9cV_.js";import{a as Ee,t as Ne}from"./Export-DV3j_OQc.js";const Ue=te({components:{IonToolbar:ne,IonItem:ae,IonIcon:re,IonLabel:se,IonTitle:le,IonHeader:ie,IonButton:ue,IonFooter:ce,IonContent:de,IonButtons:fe,IonChip:pe,HisKeyboard:he,IonThumbnail:ye,IonImg:ke},props:{title:{type:String,default:"Report"},headerBadge:{type:Object},iconUrl:{type:String},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},enablePagination:{type:Boolean,default:!0},rowsPerPage:{type:Number,default:10},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},reportPrefix:{type:String,default:""}},setup(e){const c=me(),D=$([]),k=$(0),P=$(""),_=$(""),w=$("desc"),M=$(!1),K=E(()=>{let o=D.value;return w.value&&_.value&&(o=$e(D.value)[w.value](a=>a.data[_.value])),P.value?new Te(o,{threshold:.3,keys:["searchIndex"],useExtendedSearch:!0}).search(P.value,{limit:e.rowsPerPage}).map(d=>d.item):o}),m=E(()=>X.chunk(K.value,e.rowsPerPage).length),p=E(()=>k.value+2<=m.value),F=E(()=>k.value>0),A=E(()=>X.chunk(K.value,e.rowsPerPage)[k.value]),L=o=>{_.value=o,w.value=w.value==="asc"?"desc":"asc"},R=()=>Ve(o=>{const a=parseInt(o);parseInt(o)<=m.value&&(k.value=a)},{title:"Select page"}),Q=()=>k.value=0,Y=()=>k.value=m.value-1||0,q=()=>k.value+=1,W=()=>k.value-=1,G=()=>{typeof e.onFinish=="function"?e.onFinish():c.push("/")},s=o=>{var a,d;try{typeof((a=o.column)==null?void 0:a.tdClick)=="function"&&((d=o.column)==null||d.tdClick(o));return}catch(u){console.error(u)}},C=()=>e.columns.reduce((o,a)=>o.concat(a),[]).filter(o=>o.value||o.ref),l=o=>{var H,Z,x;const a=C().filter(i=>[i.canExport?i==null?void 0:i.canExport[o]:!0,typeof i.exportable=="boolean"?i.exportable:!0].every(Boolean)),d=a.map(i=>i.exportedValue&&i.exportedValue.column?i.exportedValue.column(i):i.secondaryLabel||i.label),u=a.map(i=>i.ref),b=D.value.reduce((i,ee)=>{const oe=ee.row.filter(({column:S})=>u.includes(S.ref)).map(S=>S.column.exportedValue&&S.column.exportedValue.dataValue?S.column.exportedValue.dataValue(S):S.value);return[...i,oe]},[]),j="".concat(e.reportPrefix," ").concat((H=N.getLocationName())!=null?H:""," ").concat(ze(e.title).replace(e.reportPrefix,"")," ").concat(Fe((x=(Z=e.csvQuarter)!=null?Z:e.subtitle)!=null?x:""));return{headers:d,rows:b,filename:j}},B=()=>{const{headers:o,rows:a,filename:d}=l("pdf");Ee([o],a,d,!0)},I=()=>{const{headers:o,rows:a,filename:d}=l("csv");Ne([o],[...a,["Date Created: ".concat(De().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(e.csvQuarter||e.subtitle)],["HIS-Core Version: ".concat(N.getCoreVersion())],["API Version: ".concat(N.getApiVersion())],["Site UUID: ".concat(N.getSiteUUID())],["Generated by: ".concat(N.getUserName())]],d)},O=o=>{P.value=_e(o,P.value),k.value=0},J=o=>{o.forEach(a=>{const d=C().map(u=>{let b="";const j=a[u.ref];try{X.isEmpty(a)?b="...":typeof u.toValue=="function"?b="".concat(u.toValue(j)):typeof u.value=="function"?b=u.value(a):b=a[u.ref]||""}catch(H){b=(u==null?void 0:u.defaultValue)||"_ERROR_",console.error(H)}return{column:u,refData:j,value:b,data:a}});D.value.push({row:d,data:a,searchIndex:[...d,d.map(u=>u.value).join(" ")]})})};return ve(()=>e.columnData,o=>{if(D.value=[],!Array.isArray(o)||!o.length){k.value=0,P.value="",_.value="",J(Array.from({length:e.rowsPerPage}).map(()=>({})));return}J(o)},{immediate:!0,deep:!0}),{first:Q,last:Y,next:q,prev:W,selectPage:R,sortColumn:L,onClickTablecell:s,toPDF:B,toCSV:I,finish:G,filterTable:O,sync:ge,search:Ce,close:be,arrowUp:Pe,arrowDown:we,funnelOutline:Ie,page:A,canNext:p,searchTerm:P,totalPages:m,sortOrder:w,canPrev:F,currentPage:k,columnSorted:_,QWERTY:Se,showSearchKeyboard:M}}}),Ke={key:0},Ae={class:"his-sm-text"},Oe={class:"art-report-theme"},je={class:"stick-report-header"},He=["colspan","rowspan","onClick"],Me=["onClick"],Le={class:"his-sm-text"};function Qe(e,c,D,k,P,_){const w=f("ion-img"),M=f("ion-thumbnail"),K=f("ion-title"),m=f("ion-icon"),p=f("ion-button"),F=f("ion-label"),A=f("ion-chip"),L=f("ion-buttons"),R=f("ion-toolbar"),Q=f("ion-header"),Y=f("ion-item"),q=f("ion-content"),W=f("his-keyboard"),G=f("ion-footer");return n(),v(z,null,[r(Q,null,{default:t(()=>[r(R,null,{default:t(()=>[e.iconUrl?(n(),h(M,{key:0,slot:"start"},{default:t(()=>[r(w,{src:e.iconUrl},null,8,["src"])]),_:1})):y("",!0),r(K,{slot:"start",class:"his-md-text"},{default:t(()=>[g(V(e.title)+" ",1),e.subtitle?(n(),v("br",Ke)):y("",!0),T("span",Ae,V(e.subtitle),1)]),_:1}),r(L,{slot:"end"},{default:t(()=>[typeof e.onConfigure=="function"?(n(),h(p,{key:0,onClick:c[0]||(c[0]=()=>e.onConfigure?e.onConfigure():null)},{default:t(()=>[r(m,{size:"large",icon:e.funnelOutline},null,8,["icon"])]),_:1})):y("",!0),e.searchTerm?(n(),h(A,{key:1,onClick:c[1]||(c[1]=()=>{e.searchTerm="",e.showSearchKeyboard=!1}),class:"his-md-text",color:"primary"},{default:t(()=>[r(F,null,{default:t(()=>[g(V(e.searchTerm?"Search: ".concat(e.searchTerm):""),1)]),_:1}),r(m,{icon:e.close},null,8,["icon"])]),_:1})):y("",!0),r(p,{color:e.showSearchKeyboard?"primary":"dark",onClick:c[2]||(c[2]=()=>e.showSearchKeyboard=!e.showSearchKeyboard),size:"large"},{default:t(()=>[r(m,{size:"large",icon:e.search},null,8,["icon"])]),_:1},8,["color"]),typeof e.onRefresh=="function"?(n(),h(p,{key:2,onClick:c[3]||(c[3]=()=>e.onRefresh?e.onRefresh():null),color:"success",size:"large"},{default:t(()=>[r(m,{size:"large",icon:e.sync},null,8,["icon"])]),_:1})):y("",!0)]),_:1})]),_:1}),(e.headerBadge||[]).length?(n(),h(R,{key:0,color:"light"},{default:t(()=>[(n(!0),v(z,null,U(e.headerBadge,(s,C)=>(n(),h(A,{onClick:l=>typeof s.action=="function"?s.action():null,key:C,color:(s==null?void 0:s.color)||"dark"},{default:t(()=>[r(m,{icon:(s==null?void 0:s.icon)||e.search},null,8,["icon"]),r(F,{innerHTML:s==null?void 0:s.text},null,8,["innerHTML"])]),_:2},1032,["onClick","color"]))),128))]),_:1})):y("",!0)]),_:1}),r(q,{"scroll-y":"","scroll-x":""},{default:t(()=>[T("table",Oe,[T("thead",je,[(n(!0),v(z,null,U(e.columns,(s,C)=>(n(),v("tr",{key:C},[(n(!0),v(z,null,U(s,(l,B)=>{var I,O;return n(),v("th",{key:B,colspan:((I=l==null?void 0:l.span)==null?void 0:I.thColspan)||1,rowspan:((O=l==null?void 0:l.span)==null?void 0:O.thRowspan)||1,onClick:J=>e.sortColumn(l.ref)},[r(Y,{lines:"none"},{default:t(()=>[e.columnSorted&&e.columnSorted===l.ref?(n(),h(m,{key:0,icon:e.sortOrder==="asc"?e.arrowUp:e.arrowDown},null,8,["icon"])):y("",!0),r(F,{class:"ion-text-center"},{default:t(()=>[T("b",null,V(l.label),1)]),_:2},1024)]),_:2},1024)],8,He)}),128))]))),128))]),T("tbody",null,[(n(!0),v(z,null,U(e.page,(s,C)=>(n(),v("tr",{key:C},[(n(!0),v(z,null,U(s.row,(l,B)=>{var I;return n(),v("td",{key:B,onClick:()=>e.onClickTablecell(l),class:Be({"clickable-cell":(I=l==null?void 0:l.column)==null?void 0:I.tdClick})},[T("span",Le,V(l.value),1)],10,Me)}),128))]))),128))])])]),_:1}),r(G,null,{default:t(()=>[e.showSearchKeyboard?(n(),h(W,{key:0,kbConfig:e.QWERTY,onKeyPress:e.filterTable},null,8,["kbConfig","onKeyPress"])):y("",!0),r(R,{color:"dark"},{default:t(()=>[r(p,{onClick:c[4]||(c[4]=s=>e.toCSV()),size:"large"},{default:t(()=>[g(" CSV ")]),_:1}),r(p,{onClick:c[5]||(c[5]=s=>e.toPDF()),size:"large"},{default:t(()=>[g(" PDF ")]),_:1}),e.totalPages>1?(n(),h(p,{key:0,onClick:e.first,disabled:e.currentPage===0||e.totalPages<=2,size:"large",slot:"end"},{default:t(()=>[g(" First ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(n(),h(p,{key:1,onClick:e.prev,disabled:!e.canPrev,color:"light",size:"large",slot:"end"},{default:t(()=>[g(" Prev ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(n(),h(p,{key:2,onClick:e.selectPage,size:"large",slot:"end",color:"light"},{default:t(()=>[g(V(e.currentPage)+" / "+V(e.totalPages-1),1)]),_:1},8,["onClick"])):y("",!0),e.totalPages>1?(n(),h(p,{key:3,onClick:e.next,disabled:!e.canNext,color:"light",size:"large",slot:"end"},{default:t(()=>[g(" Next ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(n(),h(p,{key:4,onClick:e.last,disabled:e.currentPage+1>=e.totalPages||e.totalPages<=2,size:"large",slot:"end"},{default:t(()=>[g(" Last ")]),_:1},8,["onClick","disabled"])):y("",!0),r(p,{onClick:e.finish,color:"success",size:"large",slot:"end"},{default:t(()=>[g(" Finish ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const We=Re(Ue,[["render",Qe],["__scopeId","data-v-540e223c"]]);export{We as v};
