import{d as h,x as m,Q as l,O as _,ag as g,aj as v,b1 as P,ct as f,bL as D,ba as w,A,B as p,o as y,c as E,w as $,a as k}from"./index-CmAu9cV_.js";import{v as F}from"./TableView-Bzp4sqn4.js";const I=25,B=h({props:{title:{type:String,default:"Drilldown"},patientIdentifiers:{type:Object},onFinish:{type:Function}},components:{IonPage:m,v2Datatable:F},setup(e){const n=l(!0),o=l("-"),a=l([]),c=_(),u=[[{label:"ARV Number",ref:"identifier"},{label:"Gender",ref:"gender"},{label:"Birthdate",ref:"birthdate"},{label:"Art start date",ref:"art_start_date"},{label:"Action",ref:"patient_id",exportable:!1,tdClick:({data:t})=>c.push({path:"/patient/dashboard/".concat(t.person_id)}),value:()=>"View client"}]];function s(){n.value=!1,typeof e.onFinish=="function"&&e.onFinish()}return g(()=>e.patientIdentifiers,async t=>{if(a.value=[],o.value="Total: 0",!(t&&t.length))return;const d=v.chunk(t,1e3);for(const b of d){try{if(!n.value)break;const i=(await P.getPersons(b)).map(r=>({...r,birthdate:f(r.birthdate),art_start_date:f(r.art_start_date),gender:D(r.gender)}));a.value=[...a.value,...i]}catch(i){console.error(i)}o.value="Total: ".concat(a.value.length," of ").concat((t||[]).length),await w(100)}},{immediate:!0}),{columns:u,subtitle:o,reportData:a,canLoadData:n,ITEMS_PER_PAGE:I,runFinishAction:s}}});function C(e,n,o,a,c,u){const s=p("v2Datatable"),t=p("ion-page");return y(),E(t,null,{default:$(()=>[k(s,{title:e.title,subtitle:e.subtitle,columnData:e.reportData,columns:e.columns,"on-finish":e.runFinishAction,rowsPerPage:e.ITEMS_PER_PAGE},null,8,["title","subtitle","columnData","columns","on-finish","rowsPerPage"])]),_:1})}const S=A(B,[["render",C]]);export{S as A};
