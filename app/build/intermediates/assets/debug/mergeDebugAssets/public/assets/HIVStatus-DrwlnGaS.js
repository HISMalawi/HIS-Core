import{H as y}from"./HisStandardForm-BPnHI1R7.js";import{bo as I,d as H,j as C,K as o,V as s,bv as d,ar as r,bw as u,o as R,c as L,w as k,m as O,u as c,E as U,e as T}from"./index-VkXRcily.js";import{u as N}from"./useEncounter-DtfrrvJj.js";import{y as v,m,r as q}from"./commons-C_iNZ7hW.js";import"./isEmpty-CqixDCqa.js";import"./encounter_guidelines-AfwsDaSv.js";import"./GuidelineEngine-D6V1_Znr.js";class l extends I{constructor(a,n){super(a,39,n)}}const z=H({__name:"HIVStatus",setup(_){let a;const n=C([]),{patientDashboardUrl:p,goToNextTask:f}=N((e,t,i)=>{a=new l(t,e),n.value=[g(),...F(i),w(),E(),A(),...h(i),...S(i),V(),D()]});async function b(e,t){if(!await a.createEncounter())return T("Unable to create encounter");const x=await q({...t});if(!await a.saveObservationList(x))return T("Unable to save observations");f()}function D(){return{id:"advised_to_visit_art",helpText:"Advised to visit ART",type:o.TT_SELECT,options:v,condition:e=>e.received_arvs.value!=="Yes",computedValue:e=>({obs:a.buildValueCoded("Advised to visit ART",e.value)})}}function V(){return{id:"art_clinic_location",helpText:"ART clinic location",type:o.TT_SELECT,computedValue:e=>({obs:a.buildValueText("ART clinic location",e.label)}),validation:e=>s.required(e),condition:e=>/Yes|Defaulter/i.test(e.received_arvs.value),options:(e,t="")=>d(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}function h(e){return r({id:"date_started_art",helpText:"Started ART",required:!0,condition:t=>t.received_arvs.value==="Yes",minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>a.getDate(),estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("Date ART started",t,i)})}function S(e){return r({id:"date_defualted_art",helpText:"ART Default",required:!0,condition:t=>t.received_arvs.value==="Defaulter",minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>a.getDate(),estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("ART default date",t,i)})}function E(){return{id:"cpt_started",helpText:"CPT Started",type:o.TT_SELECT,options:v,condition:e=>e.hiv_status.value==="Reactive",computedValue:e=>({obs:a.buildValueCoded("CPT Started",e.value)})}}function A(){return{id:"received_arvs",helpText:"Started ART?",type:o.TT_SELECT,computedValue:({value:e})=>({obs:a.buildValueCoded("ART Started",e)}),validation:e=>s.required(e),options:()=>m(["Yes","No","Defaulter","Unknown"]),condition:e=>e.hiv_status.value==="Reactive"}}function g(){return{id:"hiv_status",helpText:"HIV status",type:o.TT_SELECT,validation:e=>s.required(e),computedValue:e=>({obs:a.buildValueText("HIV status",e.label)}),options:()=>m(["Reactive","Non-reactive","Unknown"])}}function F(e){return r({id:"hiv_test_date",helpText:"HIV Test",required:!0,minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>l.getSessionDate(),condition:t=>t.hiv_status.value!=="Unknown",summaryLabel:"HIV test date",estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("HIV test date",t,i)})}function w(){return{id:"test_location",helpText:"HIV test location",type:o.TT_SELECT,validation:e=>s.required(e),defaultValue:()=>l.getLocationName(),computedValue:({label:e})=>({obs:a.buildValueText("HIV test location",e)}),condition:e=>e.hiv_status.value!=="Unknown",options:(e,t="")=>d(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}return(e,t)=>(R(),L(c(U),null,{default:k(()=>[O(y,{cancelDestinationPath:c(p),fields:n.value,onFinishAction:b,skipSummary:""},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{z as default};
