import{d as te,s as ne,z as ae,aG as re,A as se,v as le,I as ie,C as ue,D as ce,x as de,ci as fe,aF as pe,av as he,bD as ye,bE as me,a1 as ve,j as $,a3 as B,am as ke,cm as ge,cn as Ce,co as be,cp as Pe,cq as we,cr as Ie,cs as Se,ct as Ve,i as De,Y as N,ay as _e,cu as $e,cv as Te,ap as X,bF as Fe,cw as ze,_ as Re,M as f,o as n,n as k,m as r,w as t,c as h,X as y,b as g,t as V,a as T,F,q as K,aJ as Ee}from"./index-VkXRcily.js";import{a as Be,t as Ne}from"./Export-C2YlkRsK.js";const Ke=te({components:{IonToolbar:ne,IonItem:ae,IonIcon:re,IonLabel:se,IonTitle:le,IonHeader:ie,IonButton:ue,IonFooter:ce,IonContent:de,IonButtons:fe,IonChip:pe,HisKeyboard:he,IonThumbnail:ye,IonImg:me},props:{title:{type:String,default:"Report"},headerBadge:{type:Object},iconUrl:{type:String},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},enablePagination:{type:Boolean,default:!0},rowsPerPage:{type:Number,default:10},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},reportPrefix:{type:String,default:""}},setup(e){const c=ve(),D=$([]),m=$(0),P=$(""),_=$(""),w=$("desc"),L=$(!1),U=B(()=>{let o=D.value;return w.value&&_.value&&(o=$e(D.value)[w.value](a=>a.data[_.value])),P.value?new Te(o,{threshold:.3,keys:["searchIndex"],useExtendedSearch:!0}).search(P.value,{limit:e.rowsPerPage}).map(d=>d.item):o}),v=B(()=>X.chunk(U.value,e.rowsPerPage).length),p=B(()=>m.value+2<=v.value),z=B(()=>m.value>0),H=B(()=>X.chunk(U.value,e.rowsPerPage)[m.value]),Y=o=>{_.value=o,w.value=w.value==="asc"?"desc":"asc"},R=()=>Ve(o=>{const a=parseInt(o);parseInt(o)<=v.value&&(m.value=a)},{title:"Select page"}),j=()=>m.value=0,Q=()=>m.value=v.value-1||0,q=()=>m.value+=1,G=()=>m.value-=1,W=()=>{typeof e.onFinish=="function"?e.onFinish():c.push("/")},s=o=>{var a,d;try{typeof((a=o.column)==null?void 0:a.tdClick)=="function"&&((d=o.column)==null||d.tdClick(o));return}catch(u){console.error(u)}},C=()=>e.columns.reduce((o,a)=>o.concat(a),[]).filter(o=>o.value||o.ref),l=o=>{var A,Z,x;const a=C().filter(i=>[i.canExport?i==null?void 0:i.canExport[o]:!0,typeof i.exportable=="boolean"?i.exportable:!0].every(Boolean)),d=a.map(i=>i.exportedValue&&i.exportedValue.column?i.exportedValue.column(i):i.secondaryLabel||i.label),u=a.map(i=>i.ref),b=D.value.reduce((i,ee)=>{const oe=ee.row.filter(({column:S})=>u.includes(S.ref)).map(S=>S.column.exportedValue&&S.column.exportedValue.dataValue?S.column.exportedValue.dataValue(S):S.value);return[...i,oe]},[]),O="".concat(e.reportPrefix," ").concat((A=N.getLocationName())!=null?A:""," ").concat(Fe(e.title).replace(e.reportPrefix,"")," ").concat(ze((x=(Z=e.csvQuarter)!=null?Z:e.subtitle)!=null?x:""));return{headers:d,rows:b,filename:O}},E=()=>{const{headers:o,rows:a,filename:d}=l("pdf");Be([o],a,d,!0)},I=()=>{const{headers:o,rows:a,filename:d}=l("csv");Ne([o],[...a,["Date Created: ".concat(De().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(e.csvQuarter||e.subtitle)],["HIS-Core Version: ".concat(N.getCoreVersion())],["API Version: ".concat(N.getApiVersion())],["Site UUID: ".concat(N.getSiteUUID())],["Generated by: ".concat(N.getUserName())]],d)},M=o=>{P.value=_e(o,P.value),m.value=0},J=o=>{o.forEach(a=>{const d=C().map(u=>{let b="";const O=a[u.ref];try{X.isEmpty(a)?b="...":typeof u.toValue=="function"?b="".concat(u.toValue(O)):typeof u.value=="function"?b=u.value(a):b=a[u.ref]||""}catch(A){b=(u==null?void 0:u.defaultValue)||"_ERROR_",console.error(A)}return{column:u,refData:O,value:b,data:a}});D.value.push({row:d,data:a,searchIndex:[...d,d.map(u=>u.value).join(" ")]})})};return ke(()=>e.columnData,o=>{if(D.value=[],!Array.isArray(o)||!o.length){m.value=0,P.value="",_.value="",J(Array.from({length:e.rowsPerPage}).map(()=>({})));return}J(o)},{immediate:!0,deep:!0}),{first:j,last:Q,next:q,prev:G,selectPage:R,sortColumn:Y,onClickTablecell:s,toPDF:E,toCSV:I,finish:W,filterTable:M,sync:ge,search:Ce,close:be,arrowUp:Pe,arrowDown:we,funnelOutline:Ie,page:H,canNext:p,searchTerm:P,totalPages:v,sortOrder:w,canPrev:z,currentPage:m,columnSorted:_,QWERTY:Se,showSearchKeyboard:L}}}),Ue={key:0},He={class:"his-sm-text"},Me={class:"art-report-theme"},Oe={class:"stick-report-header"},Ae=["colspan","rowspan","onClick"],Le=["onClick"],Ye={class:"his-sm-text"};function je(e,c,D,m,P,_){const w=f("ion-img"),L=f("ion-thumbnail"),U=f("ion-title"),v=f("ion-icon"),p=f("ion-button"),z=f("ion-label"),H=f("ion-chip"),Y=f("ion-buttons"),R=f("ion-toolbar"),j=f("ion-header"),Q=f("ion-item"),q=f("ion-content"),G=f("his-keyboard"),W=f("ion-footer");return n(),k(F,null,[r(j,null,{default:t(()=>[r(R,null,{default:t(()=>[e.iconUrl?(n(),h(L,{key:0,slot:"start"},{default:t(()=>[r(w,{src:e.iconUrl},null,8,["src"])]),_:1})):y("",!0),r(U,{slot:"start",class:"his-md-text"},{default:t(()=>[g(V(e.title)+" ",1),e.subtitle?(n(),k("br",Ue)):y("",!0),T("span",He,V(e.subtitle),1)]),_:1}),r(Y,{slot:"end"},{default:t(()=>[typeof e.onConfigure=="function"?(n(),h(p,{key:0,onClick:c[0]||(c[0]=()=>e.onConfigure?e.onConfigure():null)},{default:t(()=>[r(v,{size:"large",icon:e.funnelOutline},null,8,["icon"])]),_:1})):y("",!0),e.searchTerm?(n(),h(H,{key:1,onClick:c[1]||(c[1]=()=>{e.searchTerm="",e.showSearchKeyboard=!1}),class:"his-md-text",color:"primary"},{default:t(()=>[r(z,null,{default:t(()=>[g(V(e.searchTerm?"Search: ".concat(e.searchTerm):""),1)]),_:1}),r(v,{icon:e.close},null,8,["icon"])]),_:1})):y("",!0),r(p,{color:e.showSearchKeyboard?"primary":"dark",onClick:c[2]||(c[2]=()=>e.showSearchKeyboard=!e.showSearchKeyboard),size:"large"},{default:t(()=>[r(v,{size:"large",icon:e.search},null,8,["icon"])]),_:1},8,["color"]),typeof e.onRefresh=="function"?(n(),h(p,{key:2,onClick:c[3]||(c[3]=()=>e.onRefresh?e.onRefresh():null),color:"success",size:"large"},{default:t(()=>[r(v,{size:"large",icon:e.sync},null,8,["icon"])]),_:1})):y("",!0)]),_:1})]),_:1}),(e.headerBadge||[]).length?(n(),h(R,{key:0,color:"light"},{default:t(()=>[(n(!0),k(F,null,K(e.headerBadge,(s,C)=>(n(),h(H,{onClick:l=>typeof s.action=="function"?s.action():null,key:C,color:(s==null?void 0:s.color)||"dark"},{default:t(()=>[r(v,{icon:(s==null?void 0:s.icon)||e.search},null,8,["icon"]),r(z,{innerHTML:s==null?void 0:s.text},null,8,["innerHTML"])]),_:2},1032,["onClick","color"]))),128))]),_:1})):y("",!0)]),_:1}),r(q,{"scroll-y":"","scroll-x":""},{default:t(()=>[T("table",Me,[T("thead",Oe,[(n(!0),k(F,null,K(e.columns,(s,C)=>(n(),k("tr",{key:C},[(n(!0),k(F,null,K(s,(l,E)=>{var I,M;return n(),k("th",{key:E,colspan:((I=l==null?void 0:l.span)==null?void 0:I.thColspan)||1,rowspan:((M=l==null?void 0:l.span)==null?void 0:M.thRowspan)||1,onClick:J=>e.sortColumn(l.ref)},[r(Q,{lines:"none"},{default:t(()=>[e.columnSorted&&e.columnSorted===l.ref?(n(),h(v,{key:0,icon:e.sortOrder==="asc"?e.arrowUp:e.arrowDown},null,8,["icon"])):y("",!0),r(z,{class:"ion-text-center"},{default:t(()=>[T("b",null,V(l.label),1)]),_:2},1024)]),_:2},1024)],8,Ae)}),128))]))),128))]),T("tbody",null,[(n(!0),k(F,null,K(e.page,(s,C)=>(n(),k("tr",{key:C},[(n(!0),k(F,null,K(s.row,(l,E)=>{var I;return n(),k("td",{key:E,onClick:()=>e.onClickTablecell(l),class:Ee({"clickable-cell":(I=l==null?void 0:l.column)==null?void 0:I.tdClick})},[T("span",Ye,V(l.value),1)],10,Le)}),128))]))),128))])])]),_:1}),r(W,null,{default:t(()=>[e.showSearchKeyboard?(n(),h(G,{key:0,kbConfig:e.QWERTY,onKeyPress:e.filterTable},null,8,["kbConfig","onKeyPress"])):y("",!0),r(R,{color:"dark"},{default:t(()=>[r(p,{onClick:c[4]||(c[4]=s=>e.toCSV()),size:"large"},{default:t(()=>[g(" CSV ")]),_:1}),r(p,{onClick:c[5]||(c[5]=s=>e.toPDF()),size:"large"},{default:t(()=>[g(" PDF ")]),_:1}),e.totalPages>1?(n(),h(p,{key:0,onClick:e.first,disabled:e.currentPage===0||e.totalPages<=2,size:"large",slot:"end"},{default:t(()=>[g(" First ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(n(),h(p,{key:1,onClick:e.prev,disabled:!e.canPrev,color:"light",size:"large",slot:"end"},{default:t(()=>[g(" Prev ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(n(),h(p,{key:2,onClick:e.selectPage,size:"large",slot:"end",color:"light"},{default:t(()=>[g(V(e.currentPage)+" / "+V(e.totalPages-1),1)]),_:1},8,["onClick"])):y("",!0),e.totalPages>1?(n(),h(p,{key:3,onClick:e.next,disabled:!e.canNext,color:"light",size:"large",slot:"end"},{default:t(()=>[g(" Next ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(n(),h(p,{key:4,onClick:e.last,disabled:e.currentPage+1>=e.totalPages||e.totalPages<=2,size:"large",slot:"end"},{default:t(()=>[g(" Last ")]),_:1},8,["onClick","disabled"])):y("",!0),r(p,{onClick:e.finish,color:"success",size:"large",slot:"end"},{default:t(()=>[g(" Finish ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const Ge=Re(Ke,[["render",je],["__scopeId","data-v-540e223c"]]);export{Ge as v};
